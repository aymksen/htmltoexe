<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to EXE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass.drag-over {
            background: rgba(102, 126, 234, 0.15);
            border: 2px dashed #667eea;
            transform: scale(1.02);
            box-shadow: 0 30px 60px rgba(102, 126, 234, 0.3);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        input[type="file"]::file-selector-button {
            display: none;
        }
        
        .upload-area {
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .drag-indicator {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(102, 126, 234, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .drag-indicator.active {
            opacity: 1;
        }
        
        .drag-icon {
            font-size: 4rem;
            animation: bounce 1s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div id="dropZone" class="glass rounded-3xl shadow-2xl p-8 max-w-md w-full relative">
        <!-- Drag Indicator Overlay -->
        <div id="dragIndicator" class="drag-indicator">
            <div class="text-center">
                <div class="drag-icon">üìÑ</div>
                <div class="text-white text-2xl font-bold mt-4">Drop HTML file here</div>
            </div>
        </div>

        <!-- Header -->
        <div class="text-center mb-8">
            <div class="text-6xl mb-4">üì¶</div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2">HTML to EXE</h1>
            <p class="text-gray-600 text-sm">Self-building executable generator</p>
        </div>

        <!-- How it works -->
        <div class="glass-card rounded-2xl p-5 mb-6">
            <div class="space-y-3">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">1Ô∏è‚É£</span>
                    <span class="text-sm text-gray-700">Upload your HTML file</span>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">2Ô∏è‚É£</span>
                    <span class="text-sm text-gray-700">Download .py file</span>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">3Ô∏è‚É£</span>
                    <span class="text-sm text-gray-700">Double-click .py ‚Üí get .exe</span>
                </div>
            </div>
        </div>

        <!-- Upload -->
        <label class="upload-area block glass-card rounded-2xl p-6 text-center cursor-pointer mb-4">
            <div class="text-4xl mb-2">üìÑ</div>
            <div class="text-sm font-medium text-gray-700 mb-1">Choose HTML file</div>
            <div class="text-xs text-gray-500">or drag and drop anywhere</div>
            <input type="file" id="fileInput" accept=".html" class="hidden">
        </label>

        <!-- File name display -->
        <div id="fileName" class="hidden glass-card rounded-xl p-3 mb-4 text-center">
            <span class="text-sm font-medium text-gray-700"></span>
        </div>

        <!-- Generate button -->
        <button id="generateBtn" disabled
            class="btn-primary w-full text-white py-4 rounded-2xl font-semibold text-base shadow-lg mb-4">
            Generate
        </button>

        <!-- Status -->
        <div id="status" class="hidden text-center p-3 rounded-xl text-sm font-medium"></div>

        <!-- Info -->
        <div class="mt-6 text-center">
            <p class="text-xs text-gray-600 leading-relaxed">
                Requires Python. The .py file auto-installs PyInstaller and builds the .exe when double-clicked.
            </p>
        </div>
    </div>

    <script>
        const dropZone = document.getElementById('dropZone');
        const dragIndicator = document.getElementById('dragIndicator');
        const fileInput = document.getElementById('fileInput');
        const generateBtn = document.getElementById('generateBtn');
        const status = document.getElementById('status');
        const fileName = document.getElementById('fileName');
        let htmlFile = null;
        let dragCounter = 0;

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Drag enter
        dropZone.addEventListener('dragenter', (e) => {
            dragCounter++;
            if (dragCounter === 1) {
                dropZone.classList.add('drag-over');
                dragIndicator.classList.add('active');
            }
        });

        // Drag leave
        dropZone.addEventListener('dragleave', (e) => {
            dragCounter--;
            if (dragCounter === 0) {
                dropZone.classList.remove('drag-over');
                dragIndicator.classList.remove('active');
            }
        });

        // Drop
        dropZone.addEventListener('drop', (e) => {
            dragCounter = 0;
            dropZone.classList.remove('drag-over');
            dragIndicator.classList.remove('active');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // Click to upload
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (file && file.name.endsWith('.html')) {
                htmlFile = file;
                generateBtn.disabled = false;
                fileName.classList.remove('hidden');
                fileName.querySelector('span').textContent = file.name;
                showStatus('‚úì ' + file.name, 'success');
            } else {
                showStatus('Please upload an HTML file', 'error');
            }
        }

        generateBtn.addEventListener('click', async () => {
            if (!htmlFile) return;

            showStatus('Generating...', 'info');

            const reader = new FileReader();
            reader.onload = async (e) => {
                const htmlContent = e.target.result;
                const name = htmlFile.name.replace('.html', '').replace(/[^a-zA-Z0-9-]/g, '_');

                const pythonScript = `#!/usr/bin/env python3
"""${name} - Self-Building HTML Launcher"""

import http.server
import socketserver
import webbrowser
import sys
import os
import subprocess
import tkinter as tk
from threading import Timer, Thread
from pathlib import Path

APP_NAME = "${name}"
HTML_CONTENT = """${htmlContent.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/`/g, '\\`')}"""

class Handler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/html; charset=utf-8')
        self.end_headers()
        self.wfile.write(HTML_CONTENT.encode('utf-8'))
    def log_message(self, format, *args):
        pass

def find_free_port(start_port=8000, max_attempts=10):
    """Find an available port"""
    import socket
    for port in range(start_port, start_port + max_attempts):
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.bind(('', port))
                return port
        except OSError:
            continue
    return None

def check_pyinstaller():
    try:
        import PyInstaller
        return True
    except ImportError:
        return False

def install_pyinstaller():
    print("Installing PyInstaller...")
    try:
        subprocess.check_call([sys.executable, "-m", "pip", "install", "pyinstaller"])
        return True
    except:
        return False

def build_exe():
    script_path = Path(__file__).resolve()
    script_dir = script_path.parent
    
    print("Building executable...")
    print(f"Output: {script_dir / (APP_NAME + '.exe')}")
    
    try:
        subprocess.run([
            sys.executable, "-m", "PyInstaller",
            "--onefile", "--noconsole", "--name", APP_NAME,
            "--distpath", str(script_dir),
            "--workpath", str(script_dir / "build_temp"),
            "--specpath", str(script_dir / "build_temp"),
            str(script_path)
        ], capture_output=True)
        
        exe_path = script_dir / f"{APP_NAME}.exe"
        
        if exe_path.exists():
            print(f"\\n‚úÖ Success! Your .exe is ready at:\\n{exe_path}")
            
            import shutil
            build_dir = script_dir / "build_temp"
            if build_dir.exists():
                shutil.rmtree(build_dir)
            return True
        return False
    except Exception as e:
        print(f"Error: {e}")
        return False

class ServerWindow:
    def __init__(self, port, httpd):
        self.port = port
        self.httpd = httpd
        self.root = tk.Tk()
        self.root.title(f"{APP_NAME}")
        self.root.geometry("400x200")
        self.root.resizable(False, False)
        
        # Center window
        self.root.update_idletasks()
        x = (self.root.winfo_screenwidth() // 2) - (400 // 2)
        y = (self.root.winfo_screenheight() // 2) - (200 // 2)
        self.root.geometry(f"+{x}+{y}")
        
        # Configure style
        self.root.configure(bg='#f0f0f0')
        
        # Icon label
        icon_label = tk.Label(
            self.root,
            text="üöÄ",
            font=("Arial", 48),
            bg='#f0f0f0'
        )
        icon_label.pack(pady=20)
        
        # Title
        title_label = tk.Label(
            self.root,
            text=f"{APP_NAME}",
            font=("Arial", 16, "bold"),
            bg='#f0f0f0'
        )
        title_label.pack()
        
        # Status
        status_label = tk.Label(
            self.root,
            text=f"Running on http://localhost:{port}",
            font=("Arial", 10),
            fg="#666",
            bg='#f0f0f0'
        )
        status_label.pack(pady=5)
        
        # Stop button
        stop_btn = tk.Button(
            self.root,
            text="Stop Server",
            font=("Arial", 12, "bold"),
            bg="#dc3545",
            fg="white",
            activebackground="#c82333",
            activeforeground="white",
            relief="flat",
            padx=20,
            pady=10,
            cursor="hand2",
            command=self.stop_server
        )
        stop_btn.pack(pady=15)
        
        self.root.protocol("WM_DELETE_WINDOW", self.stop_server)
    
    def stop_server(self):
        self.httpd.shutdown()
        self.root.destroy()
    
    def run(self):
        self.root.mainloop()

def run_server():
    port = find_free_port()
    
    if port is None:
        print("‚ùå Could not find available port")
        input("Press Enter to exit...")
        return
    
    print(f"Starting {APP_NAME} on http://localhost:{port}")
    
    def open_browser():
        webbrowser.open(f'http://localhost:{port}')
    
    try:
        with socketserver.TCPServer(("", port), Handler) as httpd:
            Timer(1.0, open_browser).start()
            
            # Start GUI in main thread
            window = ServerWindow(port, httpd)
            
            # Run server in background thread
            server_thread = Thread(target=httpd.serve_forever, daemon=True)
            server_thread.start()
            
            # Run GUI (blocks until window closed)
            window.run()
            
    except Exception as e:
        print(f"Error: {e}")
        input("Press Enter to exit...")

def main():
    if getattr(sys, 'frozen', False):
        run_server()
        return
    
    exe_path = Path(__file__).resolve().parent / f"{APP_NAME}.exe"
    
    if exe_path.exists():
        response = input("Rebuild .exe? (y/n): ").strip().lower()
        if response != 'y':
            run_server()
            return
    
    if not check_pyinstaller():
        if not install_pyinstaller():
            print("Failed to install PyInstaller")
            return
    
    if build_exe():
        response = input("\\nRun now? (y/n): ").strip().lower()
        if response == 'y':
            run_server()

if __name__ == "__main__":
    main()
`;

                const blob = new Blob([pythonScript], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${name}_autobuilder.py`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showStatus('‚úì Downloaded!', 'success');
                setTimeout(() => {
                    showStatus('Double-click the .py file to build .exe', 'info');
                }, 1500);
            };

            reader.readAsText(htmlFile);
        });

        function showStatus(message, type) {
            status.className = `text-center p-3 rounded-xl text-sm font-medium ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            status.textContent = message;
            status.classList.remove('hidden');
        }
    </script>
</body>
</html>
